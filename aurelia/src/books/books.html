<template>

  <div class="ui fluid container custom-width">
    <div class="ui grid">
      <div class="twelve wide column">
        <h1>All Books
          <span if.bind="fetchingBooksFromApi" class="ui active small inline loader"></span>
          <span if.bind="!fetchingBooksFromApi">(${numberOfBooks})</span>
        </h1>
      </div>

      <div class="four wide column">
        <select class="ui fluid dropdown" value.bind="selectedSortID" change.delegate="dropdownSortIDChangedAndCorrectURL()">
          <option repeat.for="sortID of sortIDs" model.bind="sortID.id">${sortID.string}</option>
        </select>
      </div>

      <div class="sixteen wide column">

        <a class="ui red label" if.bind="selectedCityID!=0">
          ${cities[selectedCityID-1].string}
          <i class="delete icon" click.delegate="cityTagDeleteButtonPressed()"></i>
        </a>

        <a class="ui blue label" repeat.for="selectedGenreID of selectedGenreIDs">
          ${genres[selectedGenreID-1].string}
          <i class="delete icon" click.delegate="genresTagDeleteButtonPressed(selectedGenreID)"></i>
        </a>

        <a class="ui orange label" repeat.for="selectedConditionID of selectedConditionIDs">
          ${conditions[selectedConditionID-1].string}
          <i class="delete icon" click.delegate="conditionsTagDeleteButtonPressed(selectedConditionID)"></i>
        </a>

        <a class="ui teal label" if.bind="selectedLanguageID!=0">
          ${languages[selectedLanguageID-1].string}
          <i class="delete icon" click.delegate="languageTagDeleteButtonPressed()"></i>
        </a>
      </div>

      <div class="three wide column">

        <div class="ui red segment">
          <b>Your city</b>
          <select class="ui fluid search dropdown all-books sidebar-field" id="citySelector" value.bind="selectedCityID" change.delegate="filterDataChanged()">
            <option model.bind="0" selected>All cities</option>
            <option repeat.for="city of cities" model.bind="city.id">${city.string}</option>
          </select>
        </div>

        <div class="ui blue segment">
          <b>Genres</b>
          <form class="ui form all-books sidebar-field" method="post" change.delegate="filterDataChanged()">
            <div class="grouped fields">
              <div class="field" repeat.for="genre of genres">

                <div class="ui checkbox">
                  <input type="checkbox" name="small" model.bind="genre.id" id="${genre.string}" checked.bind="selectedGenreIDs">
                  <label for="${genre.string}">${genre.string}</label>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="ui orange segment">
          <b>Book condition</b>
          <form class="ui form all-books sidebar-field" method="post" change.delegate="filterDataChanged()">
            <div class="grouped fields">
              <div class="field" repeat.for="condition of conditions">
                <div class="ui checkbox">
                  <input type="checkbox" name="small" model.bind="condition.id" id="${condition.string}" checked.bind="selectedConditionIDs">
                  <label for="${condition.string}">${condition.string}</label>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="ui teal segment">
          <b>Language</b>

          <select id="languageSelector" class="ui fluid search dropdown all-books sidebar-field" value.bind="selectedLanguageID" change.delegate="filterDataChanged()">
            <option model.bind="0" selected>All languages</option>
            <option repeat.for="language of languages" model.bind="language.id">${language.string}</option>
          </select>

        </div>
      </div>

      <div class="thirteen wide column">
        <div class="ui list">

          <div class="item horizontal-line" repeat.for="books of books.books">
            <div class="ui segment">
              <div class="ui grid book-listing-hover">

                <div class="four wide middle aligned center aligned column">
                  <a href="#" click.delegate="navigateToBookById(books.id)">
                    <img src='${books.imagepath}' class="image horizontal-line">
                  </a>
                </div>

                <div class="eight wide column">
                  <div class="content">
                    <a href="#" click.delegate="navigateToBookById(books.id)">
                      <h1 class="title horizontal-line">${books.title}</h1>
                    </a>
                    <div if.bind="ifJSONAttributeIsNull(books.author)">
                      <h2 class="author horizontal-line">by ${books.author}</h2>
                    </div>
                    <p class="description horizontal-line"></p>
                    <div if.bind="ifJSONAttributeIsNull(books.author)">
                      <div class="condition horizontal-line">
                        <span>${books.conditiondesc.string}</span>
                        <span>${books.condition}</span>
                      </div>
                    </div>
                    <div class="price horizontal-line">
                      <span>${books.price}</span>
                      <span> â‚¬</span>
                    </div>
                  </div>
                </div>

                <div class="right aligned four wide column">
                  <div class="content seller horizontal-line">
                    <div class="title">Seller: </div>
                    <div class="name">${books.userid.full_name}</div>
                    <div if.bind="ifJSONAttributeIsNull(books.author)">
                      <div class="place">${books.userid.city.string}</div>
                    </div>
                    <div class="date">${convertUnixTimeStamp(books.postdate)}</div>
                  </div>
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>

    </div>

  </div>

</template>
